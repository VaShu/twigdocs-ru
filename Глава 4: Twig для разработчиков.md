Эта глава описывает API Twig, а не сам язык шаблона. Наиболее полезна она будет тем, кто разрабатывает интерфейс шаблона для приложения, нежели для тех, кто создаёт сами шаблоны.

### **Основы**

Центральный объект в Twig - окружение (объект класса ```Twig_Environment```). Экземпляр этого класса используется для хранения конфигураций и расширений, а так же для загрузки файлов шаблонов из файловой системы или любого другого места.

Большинство приложений будут создавать единственный экземпляр класса ```Twig_Environment``` при инициализации приложения и использовать его для загрузки файлов шаблонов. Однако бывает необходимо иметь несколько экземпляров класса, если используются различные настройки окружения одновременно.

Самый простой способ настроить Twig для загрузки файлов шаблонов в приложении выглядит следующим образом:

```php
require_once '/path/to/vendor/autoload.php';

$loader = new Twig_Loader_Filesystem('/path/to/templates');
$twig = new Twig_Environment($loader, array(
  'cache' => '/path/to/compilation_cache'
));
```

После выполнения этого кода будет создана переменная окружения со стандартными настройками и файловый загрузчик, который произведён поиск файлов шаблонов в директории ```/path/to/templates```. Возможны различные конфигурации файловых загрузчиков - от стандартных до собственных разработок загружающих шаблоны из базы данных или любых других источников.

Обратите внимание, что вторым параметров при создании экземпляра класса ```Twig_Environment``` является массив опций. Опция ```cache``` указывает на директорию в которой хранятся закэшированные скомпилированные шаблоны, чтобы избежать процесса компилирования при каждом запросе к ресурсам. Этот кэш отличается от того кэша о котором вы можете подумать по результатирующему выводу, для кэширования отображаемых данных воспользуйтесь любой доступной PHP-библиотекой.

### **Отображение шаблонов**

Для загрузки файла шаблона из окружения Twig воспользуйтесь вызовом функции ```load()```, которая возвратит экземпляр класса ```Twig_TemplateWrapper```:

```php
$template = $twig->load('index.html');
```

Для отображения шаблона с переданными переменными воспользуйтесь функцией ```render()```:

```php
echo $template->render(array('name' => 'Andrew', 'city' => 'Vladimir'));
```

Метод ```display()``` сокращенный вариант для непосредственного вывода результата обработки шаблона.

Есть возможность одним махом загрузить и отобразить шаблон:

```php
$this->render('index.html', array('name' => 'Andrew', 'city' => 'Vladimir'));
```

Если шаблон определяет блоки, то вывод определенного блока можно осуществить следующим образом:

```php
$template->renderBlock('block_name', array('price' => 100.0, 'total' => 2000.0));
```

### **Настройки окружения**

Создавая экземпляр класса окружения ```Twig_Environment``` можно передать дополнительные параметры конфигурации вторым параметров в конструктор:

```php
$twig = new Twig_Environment($loader, array('debug' => true));
```

Доступны следующие параметры конфигурации:

- ```debug``` boolean
При установленном флаге - ```true```, сгенерированные шаблоны реализуют метод ```__toString()```, используя который можно вывести содержание сгенерированных узлов (веток). По-умолчанию - ```false```.

- ```charset``` string (по-умолчанию ```utf-8```)
Кодировка используемая шаблоном.

- ```base_template_class``` string (по-умолчанию ```Twig_Template```)
Базовый класс используемый для сгенерированных шаблонов.

- ```cache``` string или ```false```
Абсолютный путь для хранения скомпилированных шаблонов или ```false``` для отключения кэширования.

- ```auto_reload``` boolean
Разрабатывая с использованием Twig полезно регенерировать ранее скомпилированные шаблоны каждый раз, когда изменяется исходный код шаблона. Если эта опция не установлена, то её значение будет зависеть от значения опции ```debug```.

- ```strict_variables``` boolean
При установленном значении в ```false```, Twig будет автоматически подменять недействительные переменные (переменные и/или свойства и методы классов) на значение ```null```. При установленном значении в ```false``` Twig будет выбрасывать исключение при обнаружении недействительных переменных.

- ```autoescaping``` string
Устанавливает используемую стратегию экранирования (```name```, ```html```, ```js```, ```css```, ```url```, ```html_attr``` или PHP-коллбэк, который получает на вход название файла шаблона и возвращает наименование стратегии экранирования). Значение ```false``` отключает любое экранирование. Стратегия ```name``` определяет фактическую стратегию экранирования по наименованию файла шаблона и используемого расширения (использование этой стратегии никоим образом не влечёт за собой увеличение скорости обработки шаблонов т.к. экранирование происходит на стадии компиляции).

- ```oprimizations``` integer
Флаг определяющий какие оптимизции применять (```-1``` - по-умолчанию применяются все оптимизации, ```0``` - оптимизации отключены).

### **Загрузчики**

Загрузчики отвечают за загрузку файлов шаблонов, например, из файловой системы.

**Кэш компиляции**
