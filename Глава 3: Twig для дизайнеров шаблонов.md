Текущая глава описывает синтакс и семантику шаблонизатора Twig и будет наиболее полезна в качестве справочника тем, кто занимается разработкой шаблонов.

###### **Краткий обзор**

Шаблон представляет собой обычный текстовый файл. Шаблонизатор поддерживает любой текстовый формат - XHTML, XML, CSV, LaTeX и др. Определенные требования к расширению файла отсутствуют, он может быть как с расширением ```.html```, так и с ```.xml``` - оба варианта подойдут. 

Шаблон содержит _переменные_ и _выражения_, которые во время анализа заменяются на соответствующие значения. Так же в шаблоне могут присутствовать ```теги```, которые влияют на логику выполнения (обработки) шаблона.

Ниже представлен минимальный пример шаблона, который позволит наглядно продемонстрировать некоторые основы:
```twig
<!DOCTYPE html>
<html>
  <head>
    <title>My Webpage</title>
  </head>
  <body>
    <ul id="navigation">
      {% for item in navigation %}
        <li><a href="{{ item.href }}">{{ item.caption }}</a></li> {% endfor %}
    </ul>
    <h1>My Webpage</h1>
    {{ a_variable }}
  </body>
</html>
```

Существует три вида разделителей:
- ```{% ... %}``` : предназначен для выполнения команд, например, присвоения (```set```) или циклов.
- ```{{ ... }}``` : предназначен для вывода значений в шаблон.
- ```{# ... #}``` : предназначен для комментариев.

###### **Интеграции с IDE**

Большинство современных редакторов кода поддерживают подсветку синтаксиса и автодополнения Twig. 

Например:
- Textmate через Twig bundle
- Netbeans через Twig syntax plugin
- PhpStorm (встроенная поддержка)
- Visual Studio Code через Twig pack.

Полезный сервис - [TwigFiddle](https://twigfiddle.com/), который позволит выполнить и изучить результат работы шаблонизатора прямо в браузере.

###### **Переменные**

Приложение передаёт переменные в шаблон для управления логикой отображения и самим отображением. Переменные могут содержать аттрибуты и свойства (элементы) к которым вы можете получить доступ прямо из шаблона. То, как будет выглядеть переменная в шаблона сильно зависит от используемого приложения и того, как само приложение передаёт / описывает передаваемые переменные.

Для доступа к аттрибутам переменной (методам, свойствам PHP объектов или массивам) можно воспользоваться символом точки - ```.```, или так называемым "индексным доступом" - ```[]```.
```twig
{{ foo.bar }}
{{ foo["bar"] }}
```

В случае, если аттрибут содержит специальные символы, например, знак минуса ```-```, то необходимо воспользоваться функцией ```attribute```, вместо использования ```.```:
```twig
{{ attribute(foo, "data-foo") }}
```

_Пояснение_: использование символа ```-``` и доступа к аттрибуту через ```.``` приводит к некорректному интерпретированию выражения:
```twig
{{ foo.data-bar }}
```

Анализатор воспримет ```foo.data``` как одну переменну, из значения которой вычитают значение другой переменной - ```bar```.

Если переменная или свойство не существует, то результатирующим значением будет значение ```null``` при отключенном режиме ```strict_variables``` (равен ```false```). В случае активированного режима ```strict_variables``` (равен ```true```) Twig выбросит исключение (см. настройки окружения).

_Реализация_:
Ради удобства использования ```foo.bar```, осуществляются следующие проверки на уровне PHP:

- проверка, что ```foo``` это массив, а ```bar``` действительный элемент;
- если нет, то проверка того, что ```foo``` это объект, а ```bar``` действительное свойство;
- если нет, то проверка того, что ```foo``` это объект, а ```bar``` действительный метод;
- если нет, то проверка того, что ```foo``` это объект, а ```getBar``` действительный метод;
- если нет, то проверка того, что ```foo``` это объект, а ```isBar``` действительный метод;
- если нет, то проверка того, что ```foo``` это объект, а ```hasBar``` действительный метод;
- если нет, то вернуть значение ```null```.

В то же время ```foo["bar"]``` работает только с PHP-массивами:

- проверка, что ```foo``` это массив и ```bar``` действительный элемент;
- если нет, то вернуть значение ```null```.

Если есть необходимость обращения к динамическим аттрибутам, то рекомендуется использовать функцию ```attribute```.

**Глобальные переменные**

Следующие переменные всегда доступны в шаблонах:

- ```_self```: ссылается на текущее название шаблона.
- ```_context```: ссылается на текущий контекст.
- ```_charset```: ссылается на текущую кодировку.

Пример:

```twig
Значение переменной _self : {{ _self }}
Значение переменной _context : {{ _context }}
Значение переменной _charset : {{ _charset }}
```

Результат:

```twig
Значение переменной _self : main.twig
Значение переменной _context : Array
Значение переменной _charset : UTF-8
```

**Присваивание значений переменным**

Присваивать значения переменным можно в блоках ```{% ... %}``` использую тег ```set```:

```twig
{% set foo = 'foo' %}
{% set foo = [1, 2] %}
{% set foo = {'foo': 'bar'} %}
```

###### **Фильтры**
Переменные могут быть изменены фильтрами. Фильтры отделяются от переменных символом ```|``` (pipe symbol) и могут иметь опциональные аргументы в скобках. Фильтры можно объединять (связывать). Результат выполнение одного фильтра передаётся на вход следующему. 

В данном примере происходит удаление HTML-тегов из переменной ```name``` и последующая смена всех символов на их заглавные версии:

```twig
{{ name|striptags|title }}
```

Фильтры, которые принимают дополнительные аргументы, содержат перечень этих аргументов между ```(``` и ```)``` скобками. В приведённом примере список значений будет объединён символом запятой:

```twig
{{ list|join(', ') }}
```

Чтобы применить фильтр к секции кода воспользуйтесь тегом ```filter```:
```twig
{% filter upper %}
  Этот текст будет отображаться со всеми заглавными буквами.
{% endfilter %}
```

Со списком всех доступных фильтров можно ознакомиться [по этой ссылке](https://twig.symfony.com/doc/2.x/).

###### **Функции**

Функции могут быть вызваны для генерирования содержимого шаблонов и состоят из имени, скобок и опционального списка аргументов.

Для примера, функция ```range``` возвращает массив чисел от начального значения до конечного с определенным шагом:

```twig
{% for i in range(0, 3) %}
  {{ i }},
{% endfor %}
```

Со списком всех доступных функций можно ознакомиться [по этой ссылке](https://twig.symfony.com/doc/2.x/).

##### **Именованые аргументы**

```twig
{% for i in range(low=1, high=10, step=1) %}
  {{ i }},
{% endfor %}
```

Использование именованных аргументов делает вызов в шаблоне понятным и даёт дополнительную информацию о предназначении передаваемых параметров:

```twig
{{ data|convert_encoding('UTF-8', 'iso-2022-jp') }}

{# или #}

{{ data|convert_encoding(from='UTF-8', to='iso-2022-jp') }}
```

Именованные аргументы так же позволяют пропустить некоторые из передаваемых аргументов, для которых вы не хотите менять значения по-умолчанию:

```twig
{# первый аргумент отвечает за формт даты и при передаче значения null используется глобальный формат #}
{{ "now"|date(null, "Europe/Paris") }}

{# ... а вот как будет выглядеть вызов с использованием именованных аргументов #}
{{ "now"|date(timezone="Europe/Paris") }}
```

Безусловно есть возможность использования как именованных аргументов так и неименованных в одном вызове, однако необходимо помнить, что неименованные аргументы всегда должны следовать первыми:

```twig
{{ "now"|date("m.d.Y H:i:s", timezone="Europe/Paris") }}
```

На страницах документации, в описании каждого метода и фильтра, присутствует полный перечень поддерживаемых параметров и их наименований.
